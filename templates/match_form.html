<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>트레이너 추천</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-1: #DAD2CF;
      --color-2: #D4CDC9;
      --color-3: #DACFCB;
      --color-4: #E1D8D2;
      --color-5: #CFC6C4;
      --color-6: #E0D9D5;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Noto Sans KR', sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--color-1), var(--color-3));
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    .container {
      background: white;
      width: 90%;
      max-width: 500px;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      text-align: center;
      transition: all 0.4s ease;
    }

    .question {
      display: none;
      flex-direction: column;
      gap: 20px;
      animation: fade 0.5s ease-in-out;
    }

    .question.active {
      display: flex;
    }

    .question h2 {
      font-size: 1.4rem;
      color: #333;
      margin-bottom: 10px;
    }

    .options button {
      padding: 14px 20px;
      margin: 5px;
      border: none;
      border-radius: 16px;
      background-color: var(--color-5);
      color: #333;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .options button:hover {
      background-color: var(--color-6);
      transform: translateY(-2px);
    }

    #popup, #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: none;
    }

    #overlay {
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }

    #popup {
      z-index: 1000;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 20px;
      padding: 30px;
      width: 350px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    #popup img {
      width: 100%;
      border-radius: 16px;
      margin-bottom: 15px;
    }

    #popup button {
      background: var(--color-2);
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
    }

    @keyframes fade {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="traitForm">
      <div class="question active" data-step="1">
        <h2>1. 수업 스타일을 골라주세요</h2>
        <div class="options">
          <button type="button" data-value="E">파이팅 넘치는 수업</button>
          <button type="button" data-value="I">조용한 수업</button>
        </div>
      </div>
      <div class="question" data-step="2">
        <h2>2. 설명 방식을 골라주세요</h2>
        <div class="options">
          <button type="button" data-value="S">간단하고 명확한</button>
          <button type="button" data-value="N">원리 설명</button>
        </div>
      </div>
      <div class="question" data-step="3">
        <h2>3. 트레이너 태도</h2>
        <div class="options">
          <button type="button" data-value="T">팩트만</button>
          <button type="button" data-value="F">감정 표현 필요</button>
        </div>
      </div>
      <div class="question" data-step="4">
        <h2>4. 루틴 스타일</h2>
        <div class="options">
          <button type="button" data-value="J">계획적인 루틴</button>
          <button type="button" data-value="P">자유로운 스타일</button>
        </div>
      </div>
      <div class="question" data-step="5">
        <h2>5. 선호 트레이너</h2>
        <div class="options">
          <button type="button" data-value="남">근육질 트레이너</button>
          <button type="button" data-value="여">여자 트레이너</button>
        </div>
      </div>
    </form>
  </div>

  <div id="overlay"></div>
  <div id="popup">
    <h3 id="trainer-name"></h3>
    <img id="trainer-img" src="" alt="trainer">
    <p><a id="profile-link" href="#">트레이너 프로필 보러가기</a></p>
    <button onclick="closePopup()">닫기</button>
  </div>

  <script>
    const answers = {};
    let step = 1;

    const form = document.getElementById('traitForm');
    const questions = document.querySelectorAll('.question');

    questions.forEach((q) => {
      q.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          answers[`trait_${step}`] = btn.dataset.value;
          q.classList.remove('active');

          if (step < 5) {
            step++;
            document.querySelector(`.question[data-step="${step}"]`).classList.add('active');
          } else {
            const formData = new FormData();
            for (const key in answers) {
              formData.append(key, answers[key]);
            }

            fetch('/match', {
              method: 'POST',
              body: formData
            })
            .then(res => res.text())
            .then(html => {
              const doc = new DOMParser().parseFromString(html, 'text/html');
              const name = doc.getElementById('popup-name').textContent;
              const img = doc.getElementById('popup-img').getAttribute('src');
              const link = doc.getElementById('popup-link').getAttribute('href');

              document.getElementById('trainer-name').innerText = name;
              document.getElementById('trainer-img').src = img;
              document.getElementById('profile-link').href = link;

              document.getElementById('overlay').style.display = 'block';
              document.getElementById('popup').style.display = 'block';
            });
          }
        });
      });
    });

    function closePopup() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('popup').style.display = 'none';
      window.location.reload();
    }
  </script>
</body>
</html>
