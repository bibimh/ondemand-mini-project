<!-- templates/profile.html -->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{ trainer.tname }} íŠ¸ë ˆì´ë„ˆ í”„ë¡œí•„</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/background.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="trainer-section">
            <div class="trainer-left">
                <div class="image-carousel">
                    {% for src in image_sources %}
                        <img class="carousel-img {% if not loop.first %}hidden{% endif %}" src="{{ src }}">
                    {% endfor %}
                    {% if image_sources|length > 1 %}
                        <button class="carousel-btn left" onclick="prevImage()">&#10094;</button>
                        <button class="carousel-btn right" onclick="nextImage()">&#10095;</button>
                    {% endif %}
                </div>
            </div>
            <br>
            <div class="trainer-right">
                <h2>{{ trainer.tname }} íŠ¸ë ˆì´ë„ˆ</h2>
                <div class="trainer-intro">{{ trainer.introduce | safe }}</div>
                <br>
                <form action="/consult" method="get">
                    <input type="hidden" name="trainer_id" value="{{ trainer_id }}">
                    <button class="consult-btn">ğŸ’¬ ìƒë‹´ ì‹ ì²­í•˜ê¸°</button>
                </form>

                {% if is_admin %}
                    <br>
                    <button class="edit-btn">í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°</button>
                    <br><br>
                {% endif %}
            </div>
        </div>

        <br><hr>

        <section class="stats-section">
            <h3>ì§€ë‚œ ë‹¬ ì‹¤ì œ ë“±ë¡ íšŒì›</h3>
            <div class="chart-container">
                <canvas id="genderChart"></canvas>
                <canvas id="ageChart"></canvas>
            </div>
        </section>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            let current = 0;
            const images = document.querySelectorAll('.carousel-img');

            function showImage(index) {
                images.forEach((img, i) => {
                img.classList.toggle('hidden', i !== index);
                });
            }

            function prevImage() {
                current = (current - 1 + images.length) % images.length;
                showImage(current);
            }

            function nextImage() {
                current = (current + 1) % images.length;
                showImage(current);
            }
        </script>
        <script>
            const genderData = JSON.parse('{{ gender_data | tojson | safe }}');
            const ageData = JSON.parse('{{ age_data | tojson | safe }}');
        
            // ì„±ë³„ ë¹„ìœ¨ ì°¨íŠ¸
            new Chart(document.getElementById('genderChart'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(genderData),
                        datasets: [{
                            data: Object.values(genderData),
                            backgroundColor: ['#4BC0C0', '#FF6384'],
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });

            // ë‚˜ì´ëŒ€ ë§‰ëŒ€ ê·¸ë˜í”„
            new Chart(document.getElementById('ageChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(ageData),
                    datasets: [{
                        label: 'ì—°ë ¹ ë¹„ìœ¨ (%)',
                        data: Object.values(ageData),
                        backgroundColor: '#FF9F40'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        </script>
        
        <br><hr>

        <!-- í›„ê¸° ìš”ì•½ -->
        <section class="review-summary">
            <p>
                í›„ê¸° <span class="summary-star">â˜…</span>
                {{ avg_rating }} (ì´ {{ review_count }}ê°œ)
            </p>
            <!-- ì¶”í›„ ì •ë ¬ ê¸°ëŠ¥ êµ¬í˜„ ì‹œ -->
            <!-- í•„í„° ë²„íŠ¼ ìë¦¬ ì˜ˆì•½ -->
        </section>

        <!-- í›„ê¸° ì‘ì„± -->
        <section class="review-form">
            <h4>ë¦¬ë·° ì‘ì„±í•˜ê¸°</h4>
            <form method="POST">
                <label>ë³„ì :
                    <select name="rating">
                        {% for i in range(5, 0, -1) %}
                            <option value="{{ i }}">{{ i }}ì </option>
                        {% endfor %}
                    </select>
                </label>
                <br><br>
                <label>í›„ê¸°:</label><br>
                <textarea name="review" rows="4" cols="50" required></textarea><br><br>
                <button type="submit" class="submit-btn">ë¦¬ë·° ë“±ë¡</button>
            </form>
        </section>

        <!-- í›„ê¸° ë¦¬ìŠ¤íŠ¸ -->
        <section class="review-list">
            {% for review in reviews %}
                <div class="review-card">
                    <p class="review-meta">
                        {{ review.login_id[:-3] + '***' }} | {{ review.created_at.strftime('%Y-%m-%d') }}
                    </p>
                    <p class="review-stars">
                        <span class="star-yellow">{{ 'â˜…' * review.rating }}{{ 'â˜†' * (5 - review.rating) }}</span>
                        <span class="review-score">{{ review.rating }}</span>
                    </p>
                    <p>{{ review.comment }}</p>
                </div>
            {% endfor %}
        </section>
    </div>
</body>
</html>
